flowchart TD
    %% ===== External Services =====
    subgraph EXT[ğŸŒ External Services & APIs]
        GMaps["ğŸ—ºï¸ Google Maps API<br/>Geocoding & Spatial Data"]
        Supabase["ğŸ—„ï¸ Supabase<br/>Database, Auth, Storage"]
        GeminiAI["âœ¨ Google Gemini<br/>Vision & Text AI"]
        Eleven["ğŸ”Š ElevenLabs (TTS)<br/>Accessibility"]
    end

    %% ===== Frontend Layer =====
    subgraph FE[ğŸ’» Frontend Layer - React/Lovable App]
        A1["1ï¸âƒ£ Report Submission<br/>Photo + Postcode â†’ API"]
        A2["2ï¸âƒ£ AI Analysis<br/>Image classification & impact calculation"]
        A3["3ï¸âƒ£ Impact Report<br/>Personalized results + Council link"]
    end

    %% ===== Backend Layer =====
    subgraph BE[âš™ï¸ Backend Layer - FastAPI Server]
        B1["ğŸš€ FastAPI App<br/>Handles requests, async tasks, data orchestration"]
        B2["ğŸ§® Impact Calculation Engine"]
        B3["ğŸ—ºï¸ Postcode â†’ County Mapping"]
        B4["ğŸ” Council Data Lookup"]
        B5["ğŸ“¤ Image Upload Processor"]
    end

    %% ===== AI Processing Pipeline =====
    subgraph AI[ğŸ¤– AI Processing Pipeline]
        C1["ğŸ“¸ Waste Size Classifier<br/>Gemini Vision"]
        C2["ğŸ·ï¸ Waste Type Classifier<br/>Gemini Vision"]
        C3["ğŸ“ Impact Summary Generator<br/>Gemini Text"]
        C4["ğŸ›ï¸ Council Finder<br/>Gemini + Google Search"]
    end

    %% ===== Flow Connections =====
    A1 -->|"Submit Report"| B1
    B1 -->|"Trigger Processing"| B5
    B5 -->|"Analyze Image"| AI
    AI -->|"Return Results"| B1
    B1 -->|"Send Response"| A2
    A2 -->|"Display Report"| A3

    %% Backend internal flow
    B1 --> B2
    B1 --> B3
    B1 --> B4

    %% Backend â†” External Services
    B1 -.-> Supabase
    B1 -.-> GMaps
    B1 -.-> GeminiAI

    %% Frontend â†” External Services (direct call)
    FE -.-> Eleven

    %% AI â†” Gemini dependency
    C1 -.-> GeminiAI
    C2 -.-> GeminiAI
    C3 -.-> GeminiAI
    C4 -.-> GeminiAI

    %% Data Storage
    B1 -->|"Store & Retrieve Data"| Supabase
